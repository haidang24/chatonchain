"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.verifySignature = exports.importCryptoKey = void 0;
const utils_1 = require("../../utils");
function importCryptoKey(pem) {
    const binaryDer = utils_1.keyStringToArrayBuffer(pem);
    return utils_1.SubtleCrypto.importKey('spki', binaryDer, {
        name: 'ECDSA',
        namedCurve: 'P-256',
    }, true, ['verify']);
}
exports.importCryptoKey = importCryptoKey;
// https://gist.github.com/philholden/50120652bfe0498958fd5926694ba354
async function verifySignature(publicKey, signature, data) {
    const usignature = new Uint8Array(signature);
    const rStart = usignature[4] === 0 ? 5 : 4;
    const rEnd = rStart + 32;
    const sStart = usignature[rEnd + 2] === 0 ? rEnd + 3 : rEnd + 2;
    const r = usignature.slice(rStart, rEnd);
    const s = usignature.slice(sStart);
    const rawSignature = new Uint8Array([...r, ...s]);
    return await utils_1.SubtleCrypto.verify({
        name: 'ECDSA',
        hash: 'SHA-256',
    }, publicKey, rawSignature, data);
}
exports.verifySignature = verifySignature;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J5cHRvZ3JhcGh5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9zdHJhdGVnaWVzL3dlYkF1dGhuL2NyeXB0b2dyYXBoeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx1Q0FBbUU7QUFFbkUsU0FBZ0IsZUFBZSxDQUFDLEdBQVc7SUFDekMsTUFBTSxTQUFTLEdBQUcsOEJBQXNCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUMsT0FBTyxvQkFBWSxDQUFDLFNBQVMsQ0FDM0IsTUFBTSxFQUNOLFNBQVMsRUFDVDtRQUNFLElBQUksRUFBRSxPQUFPO1FBQ2IsVUFBVSxFQUFFLE9BQU87S0FDcEIsRUFDRCxJQUFJLEVBQ0osQ0FBQyxRQUFRLENBQUMsQ0FDWCxDQUFDO0FBQ0osQ0FBQztBQVpELDBDQVlDO0FBRUQsc0VBQXNFO0FBQy9ELEtBQUssVUFBVSxlQUFlLENBQ25DLFNBQW9CLEVBQ3BCLFNBQXNCLEVBQ3RCLElBQWlCO0lBRWpCLE1BQU0sVUFBVSxHQUFHLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzNDLE1BQU0sSUFBSSxHQUFHLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDekIsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7SUFDaEUsTUFBTSxDQUFDLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDekMsTUFBTSxDQUFDLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuQyxNQUFNLFlBQVksR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVsRCxPQUFPLE1BQU0sb0JBQVksQ0FBQyxNQUFNLENBQzlCO1FBQ0UsSUFBSSxFQUFFLE9BQU87UUFDYixJQUFJLEVBQUUsU0FBUztLQUNoQixFQUNELFNBQVMsRUFDVCxZQUFZLEVBQ1osSUFBSSxDQUNMLENBQUM7QUFDSixDQUFDO0FBdEJELDBDQXNCQyJ9